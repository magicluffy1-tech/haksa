
import streamlit as st
import pandas as pd
from datetime import datetime
import io

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(
    page_title="2026 ì„œì‚°ëª…ì§€ì¤‘ í•™ì‚¬ ì¼ì •",
    page_icon="ğŸ—“ï¸",
    layout="wide"
)

# ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í…€
st.markdown("""
    <style>
    .main { background-color: #f8f9fa; }
    .stMetric { background-color: white; padding: 20px; border-radius: 15px; border: 1px solid #eee; }
    </style>
    """, unsafe_allow_html=True)

# ì´ˆê¸° ë°ì´í„° (ê¸°ì¡´ CSV ë°ì´í„° í™œìš©)
INITIAL_CSV = """ì›”,ì£¼,ì¼,ì›”,í™”,ìˆ˜,ëª©,ê¸ˆ,í† ,ê³µíœ´ì¼,íœ´ì—…ì¼,ìˆ˜ì—…ì¼ìˆ˜,ì›”ë³„ìˆ˜ì—…ì¼ìˆ˜,í•™êµí–‰ì‚¬
3,1,1,2,3,4,5,6,7,"ì‚¼ì¼ì ˆ(1), ëŒ€ì²´ê³µíœ´ì¼(2)",,4,21,"ê°œí•™ì‹(3), ì…í•™ì‹(3)"
3,2,8,9,10,11,12,13,14,,,5,21,"ê¿ˆë””ë”¤ì§„ë¡œìœµí•©í™œë™(16), í•´ì–‘ìˆ˜ë ¨ì›ì•”ë²½ë“±ë°˜ì²´í—˜(17)"
3,3,15,16,17,18,19,20,21,,,5,21,í•™êµêµìœ¡ê³¼ì • ì„¤ëª…íšŒ(26)
3,4,22,23,24,25,26,27,28,,,5,21,
3,5,29,30,31,,,,,,2,21,
4,5,,,,1,2,3,4,,,3,22,ì²­ì†Œë…„ì˜íšŒì²´í—˜(1)
4,6,5,6,7,8,9,10,11,,,5,22,"ë“œë¡ êµìœ¡(6~10), ì½”ë”© êµìœ¡(7)"
4,7,12,13,14,15,16,17,18,,,5,22,ì½”ë”© êµìœ¡(14)
4,8,19,20,21,22,23,24,25,,,5,22,ì½”ë”© êµìœ¡(21)
4,9,26,27,28,29,30,,,,,4,22,"2,3í•™ë…„ 1í•™ê¸° 1íšŒê³ ì‚¬(28~30)"
5,9,,,,,,1,2,,ì¬ëŸ‰íœ´ì—…ì¼(1),0,17,
5,10,3,4,5,6,7,8,9,ì–´ë¦°ì´ë‚ (5),ì¬ëŸ‰íœ´ì—…ì¼(4),3,17,
5,11,10,11,12,13,14,15,16,,,5,17,ì½”ë”© êµìœ¡(12)
5,12,17,18,19,20,21,22,23,,,5,17,"ê¸¸ë§ˆë‹¹ ì¶•ì œ(21), êµë‚´ì²´ìœ¡ëŒ€íšŒ(22), ì½”ë”© êµìœ¡(19)"
5,13,24,25,26,27,28,29,30,ëŒ€ì²´ê³µíœ´ì¼(25),,4,17,ì½”ë”© êµìœ¡(26)
5,14,31,,,,,,,0,17,
"""

@st.cache_data(ttl=600)
def load_data(url=None):
    if url:
        try:
            return pd.read_csv(url)
        except:
            st.error("URL ë¡œë“œ ì‹¤íŒ¨. ê¸°ë³¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.")
    return pd.read_csv(io.StringIO(INITIAL_CSV))

# ì‚¬ì´ë“œë°” ë©”ë‰´
st.sidebar.title("ğŸ« ì„œì‚°ëª…ì§€ì¤‘")
menu = st.sidebar.radio("ë©”ë‰´ ì„ íƒ", ["ğŸ“Š ì¢…í•© í˜„í™©", "ğŸ“… ì›”ë³„ ë‹¬ë ¥", "ğŸ“‹ ì „ì²´ ì¼ì • ëª©ë¡", "âš™ï¸ ì„¤ì •"])

# ë°ì´í„° ë¡œë“œ
csv_url = st.sidebar.text_input("êµ¬ê¸€ ì‹œíŠ¸ CSV URL (ì˜µì…˜)", "")
df = load_data(csv_url if csv_url else None)

if menu == "ğŸ“Š ì¢…í•© í˜„í™©":
    st.title("2026í•™ë…„ë„ í•™ì‚¬ ìš´ì˜ ëŒ€ì‹œë³´ë“œ")
    
    # ìƒë‹¨ ì§€í‘œ
    col1, col2, col3 = st.columns(3)
    with col1:
        st.metric("ì´ ìˆ˜ì—…ì¼ìˆ˜", f"{int(df['ì›”ë³„ìˆ˜ì—…ì¼ìˆ˜'].unique().sum())}ì¼")
    with col2:
        st.metric("ì§„í–‰ ì¤‘ì¸ ë‹¬", f"{datetime.now().month}ì›”")
    with col3:
        st.metric("ì—…ë°ì´íŠ¸ ìƒíƒœ", "ì‹¤ì‹œê°„(LIVE)")

    st.divider()
    
    # D-Day ì„¹ì…˜ (ê°„ë‹¨ êµ¬í˜„)
    st.subheader("ğŸ”” ë‹¤ê°€ì˜¤ëŠ” ì£¼ìš” ì¼ì •")
    events = df[df['í•™êµí–‰ì‚¬'].notna()][['ì›”', 'í•™êµí–‰ì‚¬']]
    for _, row in events.head(5).iterrows():
        st.info(f"**[{row['ì›”']}ì›”]** {row['í•™êµí–‰ì‚¬']}")

elif menu == "ğŸ“… ì›”ë³„ ë‹¬ë ¥":
    st.title("í•™ì‚¬ ë‹¬ë ¥")
    month = st.selectbox("ì›” ì„ íƒ", df['ì›”'].unique())
    month_df = df[df['ì›”'] == month]
    st.dataframe(month_df, use_container_width=True)

elif menu == "ğŸ“‹ ì „ì²´ ì¼ì • ëª©ë¡":
    st.title("í•™ì‚¬ ì¼ì • ìƒì„¸ ëª©ë¡")
    search = st.text_input("í–‰ì‚¬ëª… ê²€ìƒ‰")
    if search:
        display_df = df[df['í•™êµí–‰ì‚¬'].str.contains(search, na=False)]
    else:
        display_df = df
    st.table(display_df[['ì›”', 'ê³µíœ´ì¼', 'íœ´ì—…ì¼', 'í•™êµí–‰ì‚¬']])

elif menu == "âš™ï¸ ì„¤ì •":
    st.title("ë°ì´í„° ê´€ë¦¬")
    st.write("êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ 'ì›¹ì— ê²Œì‹œ' -> 'CSV'ë¡œ ì„ íƒí•œ ì£¼ì†Œë¥¼ ì•„ë˜ì— ì…ë ¥í•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.")
    new_url = st.text_input("CSV ì£¼ì†Œ ì…ë ¥", csv_url)
    if st.button("ì ìš©í•˜ê¸°"):
        st.success("ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
